<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  
</body>
<script>
  // 在最坏的情况下它也能保证使用～2NlgN次比较和恒定的额外空间。
  // 堆排序 将N个元素排序，堆排序只需少于（2NlgN+2N）次比较（以及一半次数的交换）。2N项来自于堆的构造, 。2NlgN项来自于每次下沉操作最大可能需要2lgN次比较
  // 堆排序可以分为两个阶段。1.在堆的构造阶段中，我们将原始数组重新组织安排进一个堆中；2.然后在下沉排序阶段，我们从堆中按递减顺序取出所有元素并得到排序结果。

  // 堆的构造：
  // 由N个给定的元素构造一个堆有多难？我们当然可以在与NlogN成正比的时间内完成这项任务，只需从左至右遍历数组，用swim()保证扫描指针左侧的所有元素已经是一棵堆有序的完全树即可，就像连续向优先队列中插入元素一样。
  // -----------------------------------------------------------------------------------------
  // !!!!!更好的更高效的办法：从右至左用sink()函数构造子堆。数组的每个位置都已经是一个子堆的根结点了，sink()对于这些子堆也适用。
  // 如果一个结点的两个子结点都已经是堆了，那么在该结点上调用sink()可以将它们变成一个堆。这个过程会递归地建立起堆的秩序。这个过程会递归地建立起堆的秩序。
  // 开始时我们只需要扫描数组中的一半元素，因为我们可以跳过大小为1的子堆(因为假设是11最后一个元素，他的后面根本就没有元素)。最后我们在位置1上调用sink()方法，扫描结束
  // 在排序的第一阶段，堆的构造方法和我们的想象有所不同，因为我们的目标是构造一个堆有序的数组并使最大元素位于数组的开头（次大的元素在附近）而非构造函数结束的末尾。

  function sink(a, k, n) {
    // 轮询的条件为k的子节点<=N就是子节点是数组最后一个元素
    // 为什么是2*k <= N，< N因为是最后一个结点有右子节点，等于N就是父节点没有右子节点，左子节点就是他的最后一个元素
    while (2 * k <= n) {
      // 找到子节点
      var j = 2 * k;
      // 左子节点不是最后一个元素，并且左子节点小于右子节点
      // 如果左子节点小于右子节点，那就让a[k]与右子节点去比较（找到两个子节点中左右最大的结点）
      if (j < n && a[j] < a[j + 1]) {
        j++;
      }
      // 判断k和j，如果a[k] > a[j]那就终止循环，因为a[k]比他的子节点大了
      if (a[k] > a[j]) break;
      // 交换元素
      var temp = a[k];
      a[k] = a[j];
      a[j] = temp;
      // 对k重新赋值
      k = j;
    }
  }

  // a [null, "s", "o", "r", "t", "e", "x", "a", "m", "p", "l", "e"]
  function heapSort(a) {
    var N = a.length  - 1;
    // for循环构造最大堆
    for(var k = Math.floor(N/2); k >= 1; k--) {
      sink(a, k, N);
    }
    console.log(a);
    // while循环将最大的元素a[1]喝a[N]交换并修复了堆，如此直到堆变空
    // N = 1就不需要了，因为就一个元素了
    while(N > 1) {
      // 将最大的跟a[N]换
      var temp = a[1];
      a[1] = a[N];
      a[N] = temp;
      N--;
      // 将N--缩小范围重新排序
      sink(a, 1, N);
      console.log(a)
    } 
    return a;
  }
  console.log(heapSort([null, "s", "o", "r", "t", "e", "x", "a", "m", "p", "l", "e"]))
</script>
</html>